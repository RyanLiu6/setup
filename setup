#!/bin/bash
set -e

# Determine the setup directory
SETUP_DIR="${SETUP_DIR:-$HOME/dev/setup}"

# Source platform detection helpers
source "$SETUP_DIR/lib/platform.sh"

echo "======================================"
echo "Development Environment Setup"
echo "======================================"
echo ""

# Print platform info
print_platform_info
echo ""

# Setup package manager based on OS
OS=$(detect_os)

case "$OS" in
    macos)
        setup_homebrew
        ;;
    linux)
        # Ensure we have sudo access for package installation
        if ! command -v sudo &> /dev/null; then
            echo "⚠️  sudo is required for package installation on Linux"
            exit 1
        fi
        echo "✓ Using system package manager"
        ;;
    *)
        echo "⚠️  Unsupported operating system: $(uname -s)"
        exit 1
        ;;
esac

echo ""

# Run setup scripts for each component
"$SETUP_DIR/terminal/setup"
"$SETUP_DIR/direnv/setup"
"$SETUP_DIR/git/setup"
"$SETUP_DIR/shell/setup"

echo ""
echo "======================================"
echo "✓ Setup complete!"
echo "======================================"
echo ""
echo "Please restart your terminal or run: source ~/.zshrc"
echo ""
