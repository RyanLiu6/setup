#!/bin/bash
set -e

# Thin wrapper — platform bootstrap, then delegate to invoke.

SETUP_DIR="${SETUP_DIR:-$HOME/dev/setup}"

source "$SETUP_DIR/lib/platform.sh"

# Platform bootstrap (Homebrew on macOS) — must happen before uv/invoke.
OS=$(detect_os)
case "$OS" in
    macos)
        setup_homebrew
        ;;
    linux)
        if ! command -v sudo &> /dev/null; then
            echo "⚠️  sudo is required for package installation on Linux"
            exit 1
        fi
        ;;
    *)
        echo "⚠️  Unsupported operating system: $(uname -s)"
        exit 1
        ;;
esac

uv sync --quiet --directory "$SETUP_DIR"
uv run --directory "$SETUP_DIR" inv setup
