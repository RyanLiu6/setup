#!/bin/bash
set -e

REPO_DIR="${REPO_DIR:-$(cd "$(dirname "$0")/.." && pwd)}"

# Source platform detection helpers
source "$REPO_DIR/lib/platform.sh"

echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "Git Configuration Setup"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""

# Check if git is installed
if ! command -v git &> /dev/null; then
    echo "‚ö†Ô∏è  Git is not installed. Please install git first."
    exit 1
fi

echo "üìù Configuring git..."
echo ""

# Symlink global gitignore
ensure_symlink "$REPO_DIR/git/.gitignore_global" ~/.gitignore_global ".gitignore_global"

# Configure git to use shared configuration
git config --global include.path "$REPO_DIR/git/.gitconfig.shared"
echo "  ‚úì Configured git to include shared configuration"
echo "  ‚úì Shared config includes: aliases, push/fetch/merge settings, URL rewrites"

# Configure core.excludesfile (must be in main config, not shared, due to path resolution)
git config --global core.excludesfile ~/.gitignore_global
echo "  ‚úì Configured git to use global gitignore"

echo ""
echo "‚úì Git configuration complete!"
echo ""
