#!/bin/bash
set -e

SETUP_DIR="${SETUP_DIR:-$HOME/dev/setup}"

echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "Git Configuration Setup"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""

# Check if git is installed
if ! command -v git &> /dev/null; then
    echo "‚ö†Ô∏è  Git is not installed. Please install git first."
    exit 1
fi

echo "üìù Configuring git..."
echo ""

# Symlink global gitignore
if [ -L ~/.gitignore_global ]; then
    echo "  ‚úì .gitignore_global already linked"
elif [ -f ~/.gitignore_global ]; then
    echo "  ‚Üí Backing up existing .gitignore_global..."
    mv ~/.gitignore_global ~/.gitignore_global.backup
    ln -s "$SETUP_DIR/git/.gitignore_global" ~/.gitignore_global
    echo "  ‚úì .gitignore_global linked (backup saved)"
else
    ln -s "$SETUP_DIR/git/.gitignore_global" ~/.gitignore_global
    echo "  ‚úì .gitignore_global linked"
fi

# Configure git to use shared configuration
git config --global include.path "~/dev/setup/git/.gitconfig.shared"
echo "  ‚úì Configured git to include shared configuration"
echo "  ‚úì Shared config includes: aliases, push/fetch/merge settings, URL rewrites"

# Configure core.excludesfile (must be in main config, not shared, due to path resolution)
git config --global core.excludesfile ~/.gitignore_global
echo "  ‚úì Configured git to use global gitignore"

echo ""
echo "‚úì Git configuration complete!"
echo ""
