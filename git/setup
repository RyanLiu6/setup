#!/bin/bash
set -e

SETUP_DIR="${SETUP_DIR:-$HOME/dev/setup}"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Git Configuration Setup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Check if git is installed
if ! command -v git &> /dev/null; then
    echo "âš ï¸  Git is not installed. Please install git first."
    exit 1
fi

echo "ðŸ“ Configuring git..."
echo ""

# Symlink global gitignore
if [ -L ~/.gitignore_global ]; then
    echo "  âœ“ .gitignore_global already linked"
elif [ -f ~/.gitignore_global ]; then
    echo "  â†’ Backing up existing .gitignore_global..."
    mv ~/.gitignore_global ~/.gitignore_global.backup
    ln -s "$SETUP_DIR/git/.gitignore_global" ~/.gitignore_global
    echo "  âœ“ .gitignore_global linked (backup saved)"
else
    ln -s "$SETUP_DIR/git/.gitignore_global" ~/.gitignore_global
    echo "  âœ“ .gitignore_global linked"
fi

git config --global core.excludesfile ~/.gitignore_global
echo "  âœ“ Configured git to use global gitignore"

git config --global push.autoSetupRemote true
echo "  âœ“ Configured git push to auto-setup remote tracking"

git config --global fetch.prune true
echo "  âœ“ Configured git fetch/pull to auto-prune deleted remote branches"

git config --global alias.com '!git checkout main 2>/dev/null || git checkout master'
echo "  âœ“ Added 'git com' alias to checkout main/master"

echo ""
echo "âœ“ Git configuration complete!"
echo ""
