#!/bin/bash
set -e

REPO_DIR="${REPO_DIR:-$(cd "$(dirname "$0")/.." && pwd)}"

# Source platform detection helpers
source "$REPO_DIR/lib/platform.sh"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Rectangle Setup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

OS=$(detect_os)

if [[ "$OS" != "macos" ]]; then
    echo "â„¹ï¸  Rectangle is macOS only, skipping"
    echo ""
    exit 0
fi

# Install Rectangle
if ! brew list --cask rectangle &> /dev/null; then
    echo "ğŸ“¦ Installing Rectangle..."
    brew install --cask rectangle
    echo "âœ“ Rectangle installed successfully"
else
    echo "âœ“ Rectangle already installed"
fi

echo ""

# Symlink Rectangle plist so UI changes persist to the repo
echo "ğŸ“ Configuring Rectangle..."
ensure_symlink "$REPO_DIR/rectangle/com.knollsoft.Rectangle.plist" "$HOME/Library/Preferences/com.knollsoft.Rectangle.plist" "Rectangle plist"

echo ""
echo "âœ“ Rectangle setup complete!"
echo ""
