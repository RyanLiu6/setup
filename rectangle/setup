#!/bin/bash
set -e

REPO_DIR="${REPO_DIR:-$(cd "$(dirname "$0")/.." && pwd)}"

# Source platform detection helpers
source "$REPO_DIR/lib/platform.sh"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Rectangle Setup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

OS=$(detect_os)

if [[ "$OS" != "macos" ]]; then
    echo "â„¹ï¸  Rectangle is macOS only, skipping"
    echo ""
    exit 0
fi

# Install Rectangle
if ! brew list --cask rectangle &> /dev/null; then
    echo "ðŸ“¦ Installing Rectangle..."
    brew install --cask rectangle
    echo "âœ“ Rectangle installed successfully"
else
    echo "âœ“ Rectangle already installed"
fi

echo ""

PLIST_SRC="$REPO_DIR/rectangle/com.knollsoft.Rectangle.plist"
PLIST_DST="$HOME/Library/Preferences/com.knollsoft.Rectangle.plist"

if [[ -L "$PLIST_DST" ]]; then
    rm "$PLIST_DST"
    echo "âœ“ Removed stale plist symlink"
fi

defaults delete com.knollsoft.Rectangle &>/dev/null || true
cp "$PLIST_SRC" "$PLIST_DST"
echo "âœ“ Rectangle preferences installed"

echo ""
echo "âœ“ Rectangle setup complete!"
echo ""
