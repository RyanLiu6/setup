#!/bin/bash
set -e

SETUP_DIR="${SETUP_DIR:-$HOME/dev/setup}"

# Source platform detection helpers
source "$SETUP_DIR/lib/platform.sh"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Shell Configuration Setup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

OS=$(detect_os)

# Ensure zsh is installed (especially important for Linux)
ensure_zsh

echo "ğŸ“ Copying shell configuration files..."
echo ""

# Copy shell config files
if [[ -f "$SETUP_DIR/shell/.zprofile" ]]; then
    cp "$SETUP_DIR/shell/.zprofile" ~/.zprofile
    echo "  âœ“ Copied .zprofile to home directory"
fi

cp "$SETUP_DIR/shell/.zshrc" ~/.zshrc
echo "  âœ“ Copied .zshrc to home directory"

echo ""

# Check if zsh is available
ZSH_PATH=$(get_zsh_path)

if [[ -z "$ZSH_PATH" ]]; then
    echo "âš ï¸  zsh not found. Please install zsh manually."
    exit 1
fi

# Prompt user to change shell if not already zsh
if [[ "$SHELL" != "$ZSH_PATH" && "$SHELL" != "/bin/zsh" && "$SHELL" != "/usr/bin/zsh" ]]; then
    echo "ğŸš Your default shell is not zsh."
    echo ""
    echo "To change your default shell to zsh, run:"
    echo "  chsh -s $ZSH_PATH"
    echo ""
else
    echo "âœ“ Default shell is already zsh"
fi

echo ""
echo "âœ“ Shell configuration complete!"
echo ""
